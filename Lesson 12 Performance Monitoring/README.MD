Необходимый минимум устанавливается с помощью этой роли: htop, atop, net-tools, sysstat, atop (с запуском каждые 30 секунд).<br>

Из параметров ядра:<br>
vm.swapiness = 1 для уменьешния аппетитов использования swap<br>
net.core.somaxconn = 1024 — размер очереди установленных соединений ожидающих обработки accept()<br>
net.ipv4.tcp_max_syn_backlog = 1024 — размер очереди не установленных соединений<br>

Также как пример привожу значения, которые мы используем для NFS-сервера (не считаю нужным их включать в baserole, т.к. они специфичны для конкретного сервера):<br>

net.ipv4.tcp_window_scaling = 1 - включена для оптимизации использования ширины канала (масштабирование tcp-окна)<br>
net.ipv4.tcp_timestamps = 1 - рекомендуется включать при включенном tcp_sack <br>
net.ipv4.tcp_sack = 1 - включаем Selective Acknowledgements (в TCP-заголовке появляется флаг SACK). Этот режим выборочно подтверждает каждый сегмент в TCP-окне. Позволяет пересылать отдельные сегменты TCP-окна, а не всё окно <br>

Также были выставлены буферы соединения:<br>
net.ipv4.tcp_rmem = 10240 87380 12582912<br>
net.ipv4.tcp_wmem = 10240 87380 12582912<br>
Максимальные размеры буферов в байтах:<br>
net.core.wmem_max = 12582912<br>
net.core.rmem_max = 12582912<br>

net.ipv4.tcp_mtu_probing = 1 - контролирует TCP Packetization-Layer Path MTU Discovery; для jumbo фреймов (включается если обнаруживает ICMP black hole)<br>
net.ipv4.tcp_base_mss = 1024 - согласно rfc4821 "safe enough"<br>
net.ipv4.tcp_congestion_control = htcp - используется для больших и быстрых каналов (протоколов много, выбрали этот т.к. его советуют, тесты не проводили)<br>

net.ipv4.tcp_no_metrics_save = 1 - отключение кеширования метрик закрывающихся соединений (по дефолту отключен, что логично для обычных нагрузок, но может снижать производительность в случае 10G)<br>
net.core.netdev_max_backlog = 5000 - размер очереди пакетов между сетевой картой и ядром<br>
vm.min_free_kbytes = 10485760 - минимальный размер свободной памяти который необходимо поддерживать<br>
